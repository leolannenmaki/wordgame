<!doctype html>
<html lang=en>
<head>
    <meta charset=utf-8>
    <title>Wordgame</title>
    <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.5/themes/cupertino/jquery-ui.css" rel="stylesheet" type="text/css" />
</head>
<body>
    <div id="info" style="overflow: hidden; height: 18px;"></div>
    <form id="login">
        <input type="text" name="name" placeholder="Enter your name" autofocus/> 
        <input type="submit" value="Go" />
    </form>
    <div id="wordgame">
        <div id="player"></div> 
        <div id="opponents"></div>
    </div>
    <form id="end-turn">
        <input type="submit" value="End Turn" />
    </form>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.5/jquery-ui.min.js"></script>
    <script src="/dnode.js"></script>
    <script src="/client.js"></script>
    <script>
        $(function () {
            var Player = wordgame.require('common').Player,
                Board = wordgame.require('common').Board,
                DomBoard = wordgame.require('client').DomBoard,
                DomTileSet = wordgame.require('client').DomTileSet;
            function info (text) {
                $('#info').prepend('<div>' + text + '</div>');
            }
            
            var player = null,
                domTileSet = null,
                board = null
                domBoard = null,
                placements = [];
            $('#wordgame').hide();
            $('#end-turn').hide();

            $('#login').submit(function (e) {
                e.preventDefault();
                $('#login').hide();
                $('#wordgame').show();
                DNode({
                    getLoginName : function (f) { f($('input[name="name"]').val()); },
                    setPlayer: function (p) { 
                        window.p = player = Player.fromJson(p);
                        board = new Board(10);
                        domBoad = new DomBoard('#wordgame', board);
                        domTileSet = new DomTileSet('#wordgame', player.getTiles()); 
                        $('#player').text(player.getName() + ' points: ' + player.getPoints());
                        info('Waiting for turn');
                    },
                    yourTurn: function (endTurn) {
                        info('Your turn');
                        domTileSet.activate();
                        $('#end-turn').show().submit(function (e) {
                            e.preventDefault();
                            endTurn({
                                placements: placements
                            });
                            placements = [];
                            $(this).hide().unbind();
                            domTileSet.deactivate();
                            info('Waiting for opponents');
                        });
                                            },
                    gameEvent: function () {
                    },
                    info: function (text) {
                        info(text);
                    }
                }).connect(function (remote) {
                    remote.register();
                });
            });
            $('body').bind('tile.set', function (event, x, y, c) {
                placements.push({x: x, y: y, c: c});
            });
        }); 
    </script>
</body>
</html>

